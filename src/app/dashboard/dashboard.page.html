<ion-content [fullscreen]="true">
  
  <div class="content-wrapper">
    <!-- Header Personalizado -->
    <div class="custom-header">
      <div class="header-content">
        <div class="header-title">
          <ion-icon name="water"></ion-icon>
          <div>
            <h1>Dashboard de Sensores</h1>
            <p>Monitoramento em tempo real</p>
          </div>
        </div>
        <div class="header-badge">
          <ion-icon name="pulse"></ion-icon>
          <span>Online</span>
        </div>
      </div>
    </div>
  
  <!-- Status de Atualização -->
  <ion-card class="status-card">
    <ion-card-content>
      <div class="status-content">
        <div class="status-info">
          <ion-icon 
            [name]="atualizacaoAutomatica ? 'sync-circle' : 'pause-circle'" 
            [color]="atualizacaoAutomatica ? 'success' : 'medium'"
            class="status-icon">
          </ion-icon>
          <div>
            <h3>{{ atualizacaoAutomatica ? 'Atualização Automática' : 'Atualização Pausada' }}</h3>
            <p *ngIf="ultimaAtualizacao" class="ultima-atualizacao">
              Última atualização: {{ ultimaAtualizacao | date:'dd/MM/yyyy HH:mm:ss' }}
            </p>
          </div>
        </div>
        
        <div class="status-actions">
          <ion-button 
            [color]="atualizacaoAutomatica ? 'medium' : 'success'" 
            (click)="toggleAtualizacaoAutomatica()"
            size="small">
            <ion-icon [name]="atualizacaoAutomatica ? 'pause' : 'play'" slot="start"></ion-icon>
            {{ atualizacaoAutomatica ? 'Pausar' : 'Iniciar' }}
          </ion-button>
          
          <ion-button 
            color="primary" 
            (click)="carregarDados()"
            [disabled]="carregando"
            size="small">
            <ion-icon name="refresh" slot="start"></ion-icon>
            {{ carregando ? 'Atualizando...' : 'Atualizar' }}
          </ion-button>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Loading Spinner -->
  <ion-spinner *ngIf="carregando && !registroMaisRecente" name="crescent" class="spinner-center"></ion-spinner>

  <!-- REGISTRO MAIS RECENTE (DESTACADO) -->
  <div *ngIf="registroMaisRecente && !carregando" class="registro-destaque-container">
    <div class="sensores-header">
      <h2>
        <ion-icon name="sparkles-outline"></ion-icon>
        Registro Mais Recente
      </h2>
      <ion-badge color="success">Atual</ion-badge>
    </div>

    <ion-card class="sensor-card destaque">
      <!-- Header do Card -->
      <ion-card-header>
        <div class="sensor-header">
          <div class="sensor-info">
            <div class="icon-wrapper">
              <ion-icon 
                [name]="getIconeSensor(registroMaisRecente.tipo || 'default')" 
                [color]="getCorSensor(registroMaisRecente.tipo || 'default')"
                class="sensor-icon-large">
              </ion-icon>
            </div>
            <div class="sensor-text">
              <ion-card-title>{{ registroMaisRecente.nome || registroMaisRecente.tipo || 'Sensor' }}</ion-card-title>
              <ion-card-subtitle *ngIf="registroMaisRecente.localizacao">
                <ion-icon name="location-outline"></ion-icon>
                {{ registroMaisRecente.localizacao }}
              </ion-card-subtitle>
            </div>
          </div>
          
          <!-- Badge de Status -->
          <div class="status-badge" [class]="registroMaisRecente.status || 'ativo'">
            <ion-icon name="ellipse"></ion-icon>
            {{ registroMaisRecente.status || 'Ativo' }}
          </div>
        </div>
      </ion-card-header>
      
      <!-- Conteúdo do Card -->
      <ion-card-content>
        
        <!-- Timestamp -->
        <div class="sensor-timestamp">
          <ion-icon name="time-outline"></ion-icon>
          <span>{{ formatarData(registroMaisRecente.timestamp || registroMaisRecente.data) }}</span>
        </div>
        
        <!-- Grid de Medições -->
        <div class="medicoes-grid">
          
          <!-- Turbidez -->
          <div class="medicao-item" [class.indisponivel]="!registroMaisRecente.turbidez">
            <div class="medicao-header">
              <ion-icon name="contrast-outline" color="warning"></ion-icon>
              <span class="medicao-label">Turbidez</span>
            </div>
            <div class="medicao-valor">
              <span *ngIf="registroMaisRecente.turbidez">{{ registroMaisRecente.turbidez }}<span class="unidade">NTU</span></span>
              <span *ngIf="!registroMaisRecente.turbidez">N/D</span>
            </div>
          </div>
          
          <!-- pH -->
          <div class="medicao-item" [class.indisponivel]="!registroMaisRecente.ph">
            <div class="medicao-header">
              <ion-icon name="flask-outline" color="success"></ion-icon>
              <span class="medicao-label">pH</span>
            </div>
            <div class="medicao-valor">
              <span *ngIf="registroMaisRecente.ph">{{ registroMaisRecente.ph }}<span class="unidade">pH</span></span>
              <span *ngIf="!registroMaisRecente.ph">N/D</span>
            </div>
          </div>
          
          <!-- Cloro -->
          <div class="medicao-item" [class.indisponivel]="!registroMaisRecente.cloro">
            <div class="medicao-header">
              <ion-icon name="beaker-outline" color="tertiary"></ion-icon>
              <span class="medicao-label">Cloro</span>
            </div>
            <div class="medicao-valor">
              <span *ngIf="registroMaisRecente.cloro">{{ registroMaisRecente.cloro }}<span class="unidade">mg/L</span></span>
              <span *ngIf="!registroMaisRecente.cloro">N/D</span>
            </div>
          </div>
          
          <!-- Nível da Água -->
          <div class="medicao-item" [class.indisponivel]="!registroMaisRecente.nivel_agua">
            <div class="medicao-header">
              <ion-icon name="analytics-outline" color="secondary"></ion-icon>
              <span class="medicao-label">Nível Água</span>
            </div>
            <div class="medicao-valor">
              <span *ngIf="registroMaisRecente.nivel_agua">{{ registroMaisRecente.nivel_agua }}<span class="unidade">cm</span></span>
              <span *ngIf="!registroMaisRecente.nivel_agua">N/D</span>
            </div>
          </div>
          
        </div>
        
      </ion-card-content>
    </ion-card>
  </div>

  <!-- TABELA DE OUTROS REGISTROS -->
  <div *ngIf="outrosRegistros.length > 0 && !carregando" class="outros-registros-container">
    <div class="sensores-header">
      <h2>
        <ion-icon name="list-outline"></ion-icon>
        Registros Anteriores
      </h2>
      <ion-badge color="primary">{{ outrosRegistros.length }} registro(s)</ion-badge>
    </div>

    <!-- Tabela Compacta -->
    <ion-card class="tabela-registros">
      <ion-list lines="none">
        <ion-item 
          *ngFor="let registro of outrosRegistros; let i = index" 
          class="registro-item"
          [class.expandido]="isExpandido(i)"
          button
          (click)="toggleRegistro(i)">
          
          <!-- Visualização Compacta (sempre visível) -->
          <div class="registro-compacto">
            <div class="registro-info-basica">
              <ion-icon 
                [name]="getIconeSensor(registro.tipo || 'default')" 
                [color]="getCorSensor(registro.tipo || 'default')"
                class="registro-icon">
              </ion-icon>
              <div class="registro-texto">
                <h3>{{ registro.nome || registro.tipo || 'Sensor' }}</h3>
                <p>{{ formatarDataCompacta(registro.timestamp || registro.data) }}</p>
              </div>
            </div>
            
            <!-- Valores Rápidos -->
            <div class="valores-rapidos">
              <span *ngIf="registro.turbidez" class="valor-badge turbidez">
                <ion-icon name="contrast-outline"></ion-icon>
                {{ registro.turbidez }}
              </span>
              <span *ngIf="registro.ph" class="valor-badge ph">
                <ion-icon name="flask-outline"></ion-icon>
                {{ registro.ph }}
              </span>
              <span *ngIf="registro.cloro" class="valor-badge cloro">
                <ion-icon name="beaker-outline"></ion-icon>
                {{ registro.cloro }}
              </span>
            </div>

            <!-- Ícone de expandir -->
            <ion-icon 
              [name]="isExpandido(i) ? 'chevron-up-outline' : 'chevron-down-outline'" 
              class="expand-icon">
            </ion-icon>
          </div>

          <!-- Visualização Expandida (condicional) -->
          <div class="registro-expandido" *ngIf="isExpandido(i)">
            <div class="divider"></div>
            
            <!-- Status e Localização -->
            <div class="info-adicional">
              <div class="status-badge" [class]="registro.status || 'ativo'">
                <ion-icon name="ellipse"></ion-icon>
                {{ registro.status || 'Ativo' }}
              </div>
              <span *ngIf="registro.localizacao" class="localizacao">
                <ion-icon name="location-outline"></ion-icon>
                {{ registro.localizacao }}
              </span>
            </div>

            <!-- Timestamp Completo -->
            <div class="timestamp-completo">
              <ion-icon name="time-outline"></ion-icon>
              <span>{{ formatarData(registro.timestamp || registro.data) }}</span>
            </div>

            <!-- Grid de Medições Detalhado -->
            <div class="medicoes-grid-expandido">
              
              <!-- Turbidez -->
              <div class="medicao-item-expandido" *ngIf="registro.turbidez">
                <ion-icon name="contrast-outline" color="warning"></ion-icon>
                <div class="medicao-detalhes">
                  <span class="label">Turbidez</span>
                  <span class="valor">{{ registro.turbidez }} <span class="unidade">NTU</span></span>
                </div>
              </div>
              
              <!-- pH -->
              <div class="medicao-item-expandido" *ngIf="registro.ph">
                <ion-icon name="flask-outline" color="success"></ion-icon>
                <div class="medicao-detalhes">
                  <span class="label">pH</span>
                  <span class="valor">{{ registro.ph }} <span class="unidade">pH</span></span>
                </div>
              </div>
              
              <!-- Cloro -->
              <div class="medicao-item-expandido" *ngIf="registro.cloro">
                <ion-icon name="beaker-outline" color="tertiary"></ion-icon>
                <div class="medicao-detalhes">
                  <span class="label">Cloro</span>
                  <span class="valor">{{ registro.cloro }} <span class="unidade">mg/L</span></span>
                </div>
              </div>
              
              <!-- Nível Água -->
              <div class="medicao-item-expandido" *ngIf="registro.nivel_agua">
                <ion-icon name="analytics-outline" color="secondary"></ion-icon>
                <div class="medicao-detalhes">
                  <span class="label">Nível Água</span>
                  <span class="valor">{{ registro.nivel_agua }} <span class="unidade">cm</span></span>
                </div>
              </div>
              
            </div>
          </div>
          
        </ion-item>
      </ion-list>
    </ion-card>
  </div>

  <!-- Empty State -->
  <ion-card *ngIf="!carregando && dadosSensores.length === 0" class="empty-state">
    <ion-card-content>
      <ion-icon name="cube-outline" class="empty-icon"></ion-icon>
      <h2>Nenhum dado disponível</h2>
      <p>Aguardando leituras dos sensores...</p>
    </ion-card-content>
  </ion-card>

  </div>
</ion-content> 